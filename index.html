<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sovereign BTC Pilot</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        body { background: #000; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; text-align: center; }
        .price { font-size: 2.5rem; margin: 20px 0; color: #fff; }
        button { background: transparent; color: #00ff41; border: 2px solid #00ff41; padding: 20px; width: 100%; font-weight: bold; border-radius: 8px; cursor: pointer; }
        #log { font-size: 0.7rem; text-align: left; margin-top: 20px; color: #888; background: #111; padding: 10px; height: 150px; overflow-y: auto; border: 1px solid #333; }
        .highlight { color: #fff; font-weight: bold; }
    </style>
</head>
<body>
    <div style="font-size: 0.7rem;">[ ARCHITECT MODE: V1.5 ]</div>
    <div class="price" id="price">SYNCING...</div>
    
    <button id="connectBtn">INITIALIZE HANDSHAKE</button>
    
    <div id="log">> STANDBY...</div>

    <script>
        const log = (msg) => {
            const l = document.getElementById('log');
            l.innerHTML += `<br>> ${msg}`;
            l.scrollTop = l.scrollHeight;
        };

        // THE 2026 DISCOVERY LOGIC
        let detectedProvider = null;

        window.addEventListener("eip6963:announceProvider", (event) => {
            log(`Wallet Detected: <span class="highlight">${event.detail.info.name}</span>`);
            detectedProvider = event.detail.provider;
        });

        // Trigger the discovery event
        window.dispatchEvent(new Event("eip6963:requestProvider"));

        async function armSystem() {
            log("Arming system...");
            
            // Try EIP-6963 first, then window.trustwallet, then standard ethereum
            const providerSource = detectedProvider || window.trustwallet?.ethereum || window.ethereum;

            if (!providerSource) {
                log("<span style='color:red;'>CRITICAL: Handshake Failed.</span>");
                log("HINT: Are you using the 'Browser' tab in Trust Wallet?");
                return;
            }

            try {
                const provider = new ethers.providers.Web3Provider(providerSource);
                await provider.send("eth_requestAccounts", []);
                const signer = provider.getSigner();
                const address = await signer.getAddress();
                
                log(`<span class="highlight">SUCCESS: Pilot Linked to ${address.slice(0,6)}...</span>`);
                document.getElementById('connectBtn').innerText = "SYSTEM ONLINE";
                
                // INITIALIZE THE $30 BRAIN
                startPilot(signer);
            } catch (err) {
                log("ERR: Handshake Rejected by Architect.");
            }
        }

        async function getPrice() {
            const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
            const data = await res.json();
            document.getElementById('price').innerText = `$${parseFloat(data.price).toLocaleString()}`;
        }

        function startPilot(signer) {
            log("Sustainer Engine: ONLINE.");
            log("Targeting: $30 Hard Limit.");
            // Next: We code the automated swap logic here.
        }

        document.getElementById('connectBtn').onclick = armSystem;
        setInterval(getPrice, 5000);
        getPrice();
    </script>
</body>
</html>
